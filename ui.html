<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Postgres SQL Agent</title>
  <style>
    body { font-family: system-ui, Arial; max-width: 900px; margin: 32px auto; }
    textarea { width: 100%; height: 180px; }
    pre { background:#f6f7f9; padding:16px; border-radius:8px; overflow:auto; }
    .row { display:flex; gap:12px; align-items:center; }
    .row > * { flex:1; }
  </style>
</head>
<body>
  <h1>Postgres SQL Agent</h1>
  <p>Enter any SQL (SELECT/INSERT/UPDATE/DELETE). SELECTs are auto-limited unless you set LIMIT.</p>
  <div class="row">
    <label>Row limit <input id="limit" type="number" value="1000" min="1" max="5000"/></label>
    <label><input id="explain" type="checkbox"/> EXPLAIN ANALYZE</label>
  </div>
  <textarea id="sql">SELECT table_name, table_schema FROM information_schema.tables WHERE table_schema NOT IN ('pg_catalog','information_schema') ORDER BY 1;</textarea>
  <button id="run">Run</button>
  <h3>Result</h3>
  <pre id="out"></pre>
  <script>
    async function run() {
      const payload = {
        sql: document.getElementById('sql').value,
        limit: Number(document.getElementById('limit').value || 1000),
        explain: document.getElementById('explain').checked
      };
      const res = await fetch('/query', {
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify(payload)
      });
      const text = await res.text();
      try { document.getElementById('out').textContent = JSON.stringify(JSON.parse(text), null, 2); }
      catch { document.getElementById('out').textContent = text; }
    }
    document.getElementById('run').onclick = run;
  </script>
</body>
</html>
